<!doctype html>
<html lang="et">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kaisukapood ‚Äì eurode ja sentide √µppem√§ng</title>
  <style>
    :root { --bg:#fff; --fg:#111; --muted:#6b7280; --brand:#6366f1; --ok:#16a34a; --bad:#dc2626; --card:#f8fafc; --line:#e5e7eb;}
    * { box-sizing:border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--fg); background:var(--bg); }
    .wrap { max-width: 980px; margin: 24px auto; padding: 0 16px; }
    h1 { font-size: 24px; margin: 0 0 12px; }
    .row { display:grid; grid-template-columns: 1fr; gap:16px; }
    @media (min-width: 880px){ .row { grid-template-columns: 320px 1fr; } }
    .card { background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px; }
    .btn { cursor:pointer; border:0; border-radius:10px; padding:10px 14px; background:var(--brand); color:#fff; font-weight:600; }
    .btn.alt { background:#10b981; }
    .btn.ghost { background:#fff; color:var(--fg); border:1px solid var(--line); }
    .btn + .btn { margin-left:8px; }
    .muted { color:var(--muted); }
    .shop { display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:12px; }
    @media (min-width:700px){ .shop { grid-template-columns: repeat(4,minmax(0,1fr)); } }
    .item { background:#fff; border:1px solid var(--line); border-radius:16px; padding:10px; display:flex; flex-direction:column; align-items:center; gap:8px; transition: transform .12s ease, box-shadow .12s ease; }
    .item:hover { transform: translateY(-2px); box-shadow:0 6px 18px rgba(0,0,0,.06); }
    .item.selected { outline: 3px solid rgba(99,102,241,.35); }
    .pic { width:112px; height:112px; border-radius:14px; background:linear-gradient(135deg,#fff 0%,#fef6ff 100%); display:grid; place-items:center; position:relative; overflow:hidden; }
    .price { font-size:14px; }
    .foot { border-top:1px dashed var(--line); padding-top:10px; margin-top:10px; }
    ul { margin:8px 0 0 18px; padding:0; }
    .state-ok { color:var(--ok); font-weight:700; }
    .state-bad { color:var(--bad); font-weight:700; }
    .toggle { display:inline-flex; gap:6px; align-items:center; }
    .toggle input { transform: scale(1.2); }
    .chip { display:inline-flex; align-items:center; gap:8px; font-size:13px; padding:6px 10px; border:1px solid var(--line); background:#fff; border-radius:999px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Euro-m√§ng: osta kaisukaid üß∏</h1>
    <p class="muted">Vajuta ‚ÄúAnna ‚Ç¨5‚Äù v√µi ‚ÄúAnna ‚Ç¨10‚Äù, loe koos lapsega paberraha ja sentide kaupa ning vali, millised kaisukad ta saab osta.</p>

    <div class="row">
      <!-- Rahakott -->
      <section class="card">
        <h2 style="margin-top:0">Rahakott</h2>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 12px">
          <button class="btn" id="give5">Anna ‚Ç¨5</button>
          <button class="btn alt" id="give10">Anna ‚Ç¨10</button>
          <button class="btn ghost" id="clear">T√ºhjenda</button>
          <label class="chip"><input type="checkbox" id="soundOn" checked> Helid & k√µne</label>
        </div>

        <div>
          <div style="font-size:18px; margin-bottom:6px">Sinu raha: <strong id="wallet">‚Ç¨0.00</strong></div>

          <label class="toggle">
            <input type="checkbox" id="coinsOnly">
            <span>N√§ita lahutust ainult m√ºntidega (sentides)</span>
          </label>

          <div style="margin-top:10px">
            <div style="font-weight:600">Raha lahutus:</div>
            <ul id="walletBreakdown"><li>Puudub raha ‚Äî vajuta ‚ÄúAnna ‚Ç¨5‚Äù v√µi ‚ÄúAnna ‚Ç¨10‚Äù.</li></ul>
          </div>
        </div>
      </section>

      <!-- Pood -->
      <section class="card">
        <h2 style="margin-top:0">Kaisukate pood</h2>
        <div class="shop" id="shop"></div>

        <div class="foot">
          <div>Valitud kokku: <strong id="selTotal">‚Ç¨0.00</strong></div>
          <div>Kas saad osta? <strong id="afford" class="state-bad">Ei</strong></div>
          <div>Vahetus: <strong id="change">‚Ç¨0.00</strong></div>

          <div style="margin-top:8px">
            <div style="font-weight:600">Vahetuse lahutus:</div>
            <ul id="changeBreakdown"><li>Ei ole ostetud ‚Äî vahetust ei arvutata.</li></ul>
          </div>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:16px">
      <h3 style="margin:0">Kuidas m√§ngida</h3>
      <ol>
        <li>Anna lapsele raha (nupp ‚Ç¨5 v√µi ‚Ç¨10).</li>
        <li>Loendage koos lahutust: mitu paberraha ja mitme sendiga kokku saab.</li>
        <li>Valige kaisukad. Kui raha j√§tkub, n√§ete ‚ÄúJah‚Äù ja vahetuse summat ning selle lahutust.</li>
      </ol>
    </section>
  </div>

  <script>
    // ---- Andmed ----
    const BANKNOTES_COINS = [
      { value: 50000, label: "‚Ç¨500" },
      { value: 20000, label: "‚Ç¨200" },
      { value: 10000, label: "‚Ç¨100" },
      { value: 5000,  label: "‚Ç¨50"  },
      { value: 2000,  label: "‚Ç¨20"  },
      { value: 1000,  label: "‚Ç¨10"  },
      { value: 500,   label: "‚Ç¨5"   },
      { value: 200,   label: "‚Ç¨2"   },
      { value: 100,   label: "‚Ç¨1"   },
      { value: 50,    label: "50¬¢"  },
      { value: 20,    label: "20¬¢"  },
      { value: 10,    label: "10¬¢"  },
      { value: 5,     label: "5¬¢"   },
      { value: 2,     label: "2¬¢"   },
      { value: 1,     label: "1¬¢"   },
    ];

    // Nunnud kaisukad (hinnad senti)
    const PLUSHIES = [
      { id: 1, name: "Pehme Karu",     priceCents: 250, svg: "bear"    },
      { id: 2, name: "V√§ike J√§nku",    priceCents: 150, svg: "bunny"   },
      { id: 3, name: "Sinine Draakon", priceCents: 400, svg: "dragon"  },
      { id: 4, name: "Roosa √úkssarvik",priceCents: 550, svg: "unicorn" },
    ];

    // ---- Helid ----
    let audioCtx = null;
    const soundEnabled = () => document.getElementById("soundOn").checked;

    function ensureCtx(){
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    function tone(freq=800, ms=120, type='sine', gain=0.02){
      if(!soundEnabled()) return;
      ensureCtx();
      const osc = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      osc.type = type;
      osc.frequency.value = freq;
      g.gain.value = gain;
      osc.connect(g); g.connect(audioCtx.destination);
      osc.start();
      setTimeout(()=>{ osc.stop(); }, ms);
    }
    function coinDing(){ tone(1200,90,'triangle',0.03); setTimeout(()=>tone(1600,90,'triangle',0.02), 70); }
    function successJingle(){ tone(900,120,'sine',0.03); setTimeout(()=>tone(1200,160,'sine',0.03),120); setTimeout(()=>tone(1500,200,'sine',0.03),280); }
    function softNope(){ tone(220,180,'sawtooth',0.015); setTimeout(()=>tone(180,220,'sawtooth',0.012),140); }

    // K√µnes√ºntees (vaikimisi eesti h√§√§lt pole alati, aga tekst loetakse arusaadavalt)
    function say(txt){
      if(!soundEnabled()) return;
      try {
        const u = new SpeechSynthesisUtterance(txt);
        u.rate = 1; u.pitch = 1.05; u.lang = 'et-EE'; // fallback inglise h√§√§lele, kui EE puudub
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      } catch(e) { /* ignore */ }
    }

    // ---- Abifunktsioonid ----
    const ‚Ç¨ = (c) => "‚Ç¨" + (c/100).toFixed(2);

    function greedyBreakdown(totalCents, coinsOnly=false){
      const units = coinsOnly ? BANKNOTES_COINS.filter(u => u.value < 500) : BANKNOTES_COINS;
      let r = totalCents, out = [];
      for(const u of units){
        const count = Math.floor(r / u.value);
        if(count > 0){ out.push({label:u.label, count}); r -= count*u.value; }
      }
      return out;
    }

    // SVG ‚Äúpildid‚Äù ‚Äì cutesy versioonid
    function svg(kind){
      const common = 'width="100" height="100" viewBox="0 0 120 120"';
      if(kind==="bear") return `<svg ${common} xmlns="http://www.w3.org/2000/svg">
        <rect x="0" y="0" width="120" height="120" rx="16" fill="#fff6f7"/>
        <g fill="none" fill-rule="evenodd">
          <circle cx="38" cy="38" r="18" fill="#f0b48f"/>
          <circle cx="82" cy="38" r="18" fill="#f0b48f"/>
          <ellipse cx="60" cy="66" rx="34" ry="28" fill="#f7c8a5"/>
          <circle cx="50" cy="60" r="4" fill="#3B2F2F"/>
          <circle cx="70" cy="60" r="4" fill="#3B2F2F"/>
          <path d="M50 74c8 6 12 6 20 0" stroke="#3B2F2F" stroke-width="2" stroke-linecap="round"/>
          <circle cx="20" cy="18" r="3" fill="#ff8ab3"/><circle cx="100" cy="18" r="3" fill="#ff8ab3"/>
          <circle cx="14" cy="100" r="3" fill="#ffd7e8"/><circle cx="108" cy="96" r="4" fill="#ffd7e8"/>
        </g></svg>`;
      if(kind==="bunny") return `<svg ${common} xmlns="http://www.w3.org/2000/svg">
        <rect width="120" height="120" rx="16" fill="#f6f8ff"/>
        <g fill="none" fill-rule="evenodd">
          <ellipse cx="42" cy="30" rx="10" ry="26" fill="#fff2f7" transform="rotate(-18 42 30)"/>
          <ellipse cx="78" cy="30" rx="10" ry="26" fill="#fff2f7" transform="rotate(18 78 30)"/>
          <ellipse cx="60" cy="70" rx="34" ry="26" fill="#fff6fb"/>
          <circle cx="52" cy="66" r="4" fill="#2B2B2B"/>
          <circle cx="68" cy="66" r="4" fill="#2B2B2B"/>
          <path d="M56 78c4 4 8 4 12 0" stroke="#2B2B2B" stroke-width="2" stroke-linecap="round"/>
          <circle cx="16" cy="18" r="3" fill="#c7d2fe"/><circle cx="104" cy="100" r="4" fill="#c7d2fe"/>
        </g></svg>`;
      if(kind==="dragon") return `<svg ${common} xmlns="http://www.w3.org/2000/svg">
        <rect width="120" height="120" rx="16" fill="#eafffb"/>
        <g fill="none" fill-rule="evenodd">
          <ellipse cx="60" cy="72" rx="36" ry="24" fill="#bff7d6"/>
          <circle cx="48" cy="62" r="5" fill="#0b3b2a"/>
          <circle cx="72" cy="62" r="5" fill="#0b3b2a"/>
          <path d="M40 84c10 6 28 6 40 0" stroke="#0b3b2a" stroke-width="2" stroke-linecap="round"/>
          <path d="M20 60c8-12 18-18 26-20" stroke="#8be6b2" stroke-width="5" stroke-linecap="round"/>
          <circle cx="14" cy="22" r="3" fill="#b3f1cf"/><circle cx="106" cy="98" r="4" fill="#b3f1cf"/>
        </g></svg>`;
      if(kind==="unicorn") return `<svg ${common} xmlns="http://www.w3.org/2000/svg">
        <rect width="120" height="120" rx="16" fill="#fff2ff"/>
        <g fill="none" fill-rule="evenodd">
          <ellipse cx="60" cy="72" rx="36" ry="26" fill="#fff7ff"/>
          <path d="M56 40l10-16" stroke="#ff9ec4" stroke-width="5" stroke-linecap="round"/>
          <path d="M46 42c6-12 26-22 36 2" stroke="#ffd1e6" stroke-width="6" stroke-linecap="round"/>
          <circle cx="52" cy="68" r="4" fill="#3B2F2F"/>
          <circle cx="72" cy="68" r="4" fill="#3B2F2F"/>
          <circle cx="18" cy="18" r="3" fill="#ffd1e6"/><circle cx="104" cy="96" r="4" fill="#ffd1e6"/>
        </g></svg>`;
      return "";
    }

    // ---- Seis ----
    let wallet = 0;           // cents
    let selected = new Set(); // ids

    // ---- DOM ----
    const $wallet = document.getElementById("wallet");
    const $walletBreakdown = document.getElementById("walletBreakdown");
    const $change = document.getElementById("change");
    const $changeBreakdown = document.getElementById("changeBreakdown");
    const $selTotal = document.getElementById("selTotal");
    const $afford = document.getElementById("afford");
    const $shop = document.getElementById("shop");
    const $coinsOnly = document.getElementById("coinsOnly");

    // Pood
    function renderShop(){
      $shop.innerHTML = "";
      PLUSHIES.forEach(p => {
        const el = document.createElement("button");
        el.className = "item";
        el.innerHTML = `
          <div class="pic">${svg(p.svg)}</div>
          <div style="font-weight:600">${p.name}</div>
          <div class="price">${‚Ç¨(p.priceCents)}</div>
        `;
        el.setAttribute("aria-pressed", selected.has(p.id) ? "true" : "false");
        if(selected.has(p.id)) el.classList.add("selected");
        el.onclick = () => {
          if(selected.has(p.id)) selected.delete(p.id);
          else selected.add(p.id);
          coinDing();
          renderAll();
        };
        $shop.appendChild(el);
      });
    }

    function breakdownList(centSum, coinsOnly=false){
      const list = greedyBreakdown(centSum, coinsOnly);
      if(list.length === 0) return "<li>‚Äî</li>";
      return list.map(b => `<li>${b.count} √ó ${b.label}</li>`).join("");
    }

    function renderTotals(){
      const sel = Array.from(selected).map(id => PLUSHIES.find(p => p.id===id));
      const selSum = sel.reduce((a,p) => a + (p ? p.priceCents : 0), 0);
      $selTotal.textContent = ‚Ç¨(selSum);

      const can = wallet >= selSum;
      $afford.textContent = can ? "Jah" : "Ei";
      $afford.className = can ? "state-ok" : "state-bad";

      const ch = can ? (wallet - selSum) : 0;
      $change.textContent = ‚Ç¨(can ? ch : 0);
      $changeBreakdown.innerHTML = can
        ? breakdownList(ch, $coinsOnly.checked)
        : "<li>Ei ole ostetud ‚Äî vahetust ei arvutata.</li>";

      // Helid/k√µne vastavalt seisule
      if(selSum === 0) return;
      if(can){
        successJingle();
        say(`Saad osta! Vahetus: ${(ch/100).toFixed(2)} eurot.`);
      } else {
        softNope();
        say(`Veel ei j√§tku. Valitud on ${(selSum/100).toFixed(2)} eurot.`);
      }
    }

    function renderWallet(){
      $wallet.textContent = ‚Ç¨(wallet);
      if(wallet === 0){
        $walletBreakdown.innerHTML = '<li>Puudub raha ‚Äî vajuta ‚ÄúAnna ‚Ç¨5‚Äù v√µi ‚ÄúAnna ‚Ç¨10‚Äù.</li>';
      } else {
        $walletBreakdown.innerHTML = breakdownList(wallet, $coinsOnly.checked);
      }
    }

    function renderAll(){
      renderShop();
      renderWallet();
      renderTotals();
    }

    // ---- Nupud ----
    document.getElementById("give5").onclick  = () => { wallet = 500; selected.clear(); renderAll(); say("Sa said viis eurot."); coinDing(); };
    document.getElementById("give10").onclick = () => { wallet = 1000; selected.clear(); renderAll(); say("Sa said k√ºmme eurot."); coinDing(); };
    document.getElementById("clear").onclick  = () => { wallet = 0; selected.clear(); renderAll(); say("T√ºhjendasime rahakoti."); };
    $coinsOnly.onchange = () => { renderWallet(); renderTotals(); };

    // start
    renderAll();
  </script>
</body>
</html>
